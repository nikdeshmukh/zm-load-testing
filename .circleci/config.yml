version: 2.1

jobs:
  build-and-test:
    docker:
      - image: circleci/openjdk:8-jdk

    steps:
      - checkout

      # Add any additional build steps as necessary

  ssh-into-server:
    docker:
      - image: circleci/ssh:latest

    environment:
      SSH_KEY: $SSH_PRIVATE_KEY

    steps:
      - run:
          name: SSH into Ubuntu20 Server
          command: |
            echo "$SSH_KEY" | base64 -d > ~/.ssh/id_rsa
            chmod 600 ~/.ssh/id_rsa

            ssh -o StrictHostKeyChecking=no user@your-server-ip \<< EOF
              # Run the shell script on the server
              sh /path/to/your-script.sh
            EOF

workflows:
  version: 2
  build-and-deploy:
    jobs:
      - build-and-test
      - ssh-into-server:
          requires:
            - build-and-test
